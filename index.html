<!doctype html>
<meta charset="utf-8" />
<title>UNO R4 WiFi LED Remote</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,sans-serif;margin:0;background:#f6f7fb}
  .wrap{max-width:560px;margin:40px auto;padding:20px}
  .card{background:#fff;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:22px}
  h1{font-size:22px;margin:0 0 10px}
  .line{margin:6px 0;color:#666}
  .ok{color:#1f9d55;font-weight:700}.bad{color:#c23}
  .btns{display:flex;gap:10px;margin-top:10px}
  button{flex:1;padding:14px 16px;border:0;border-radius:10px;font-size:18px;cursor:pointer}
  .on{background:#10b981;color:#fff}.off{background:#ef4444;color:#fff}.tg{background:#3b82f6;color:#fff}
  .foot{margin-top:10px;font-size:12px;color:#888}
  pre{background:#0b1020;color:#cde3ff;border-radius:10px;padding:10px;max-height:160px;overflow:auto}
</style>

<div class="wrap">
  <div class="card">
    <h1>UNO R4 WiFi – LED 원격 제어</h1>
    <div class="line">브로커: <code id="broker"></code></div>
    <div class="line">연결 상태: <span id="conn" class="bad">연결 안됨</span></div>
    <div class="line">LED 상태: <b id="state">알 수 없음</b></div>
    <div class="btns">
      <button class="on"  onclick="send('ON')">켜기</button>
      <button class="off" onclick="send('OFF')">끄기</button>
      <button class="tg"  onclick="send('TOGGLE')">토글</button>
    </div>
    <div class="foot">토픽 프리픽스: <code id="pref"></code></div>
  </div>
  <pre id="log"></pre>
</div>

<script>
  // === 여기를 본인 값으로 ===
  const HOST = "wss://ffcf6bab.ala.asia-southeast1.emqxsl.com:8084/mqtt";
  const USER = "ljw8866";      // ← EMQX Authentication에서 만든 사용자
  const PASS = "@011266Aab";        // ← 비밀번호
  const PREFIX = "ledtest";            // ← 아두이노 코드와 100% 동일

  // === 설정 끝 ===
  document.getElementById('broker').textContent = HOST;
  document.getElementById('pref').textContent = PREFIX;

  const topicCmd = `${PREFIX}/led/cmd`;
  const topicState = `${PREFIX}/led/state`;

  const logEl = document.getElementById('log');
  const connEl = document.getElementById('conn');
  const stateEl = document.getElementById('state');
  function log(...a){ logEl.textContent += a.join(' ')+"\n"; logEl.scrollTop = logEl.scrollHeight }

  const client = mqtt.connect(HOST, {
    clientId: "web-"+Math.random().toString(16).slice(2),
    username: USER, password: PASS, keepalive: 60, clean: true,
  });

  client.on('connect', () => {
    connEl.textContent = '연결됨'; connEl.className='ok';
    log('[connect] ok');
    client.subscribe(topicState, (err)=> err?log('[sub err]',err):log('[sub]',topicState));
  });

  client.on('message', (t,p) => {
    const s = new TextDecoder().decode(p).trim();
    log('[msg]', t, '→', s);
    if (t===topicState) stateEl.textContent = s;
  });
  client.on('reconnect', ()=>log('[reconnect]'));
  client.on('error', e=>log('[error]', e?.message||e));
  function send(cmd){
    client.publish(topicCmd, cmd);
    log('[pub]', topicCmd, '←', cmd);
  }
</script>
